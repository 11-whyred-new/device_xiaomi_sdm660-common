# Apps are no longer allowed open access to /dev/ashmem, unless they
# target API level < Q.
dontaudit untrusted_app ashmem_device:chr_file open;

# please don't kill yourself unless it's allowed
dontaudit { fsck toolbox vdc zygote } self:capability kill;

dontaudit adbd self:capability sys_admin;
dontaudit blkid_untrusted self:capability sys_admin;
dontaudit crash_dump self:capability sys_admin;
dontaudit fsck self:capability sys_admin;
dontaudit hal_power_default self:capability sys_admin;
dontaudit hal_wifi_supplicant_default self:capability sys_admin;
dontaudit installd self:capability kill;
dontaudit irsc_util self:capability sys_admin;
dontaudit lmkd self:capability sys_admin;
dontaudit netutils_wrapper self:capability sys_admin;
dontaudit rfs_access self:capability sys_admin;
dontaudit rmt_storage self:capability sys_admin;
dontaudit thermal-engine self:capability sys_admin;
dontaudit toolbox self:capability { kill sys_admin };
dontaudit ueventd self:capability sys_admin;
dontaudit usbd self:capability sys_admin;
dontaudit vdc self:capability sys_admin;
dontaudit vendor_init-qti-dcvs-sh self:capability sys_admin; 
dontaudit vendor_modprobe self:capability sys_admin;
dontaudit vendor_msm_irqbalanced self:capability sys_admin;
dontaudit vendor_pd_mapper self:capability sys_admin;
dontaudit vold_prepare_subdirs self:capability sys_admin;

# We never apply OTAs when GSI is running
dontaudit hal_bootctl_default gsi_metadata_file:dir search;

# too noisy, and shouldn't even be granted by default unless necessary
dontaudit { gmscore_app hal_camera_default } property_type:file r_file_perms;
dontaudit {
  rild
  vendor_qti_init_shell
} default_prop:file r_file_perms;

# untrusted_app shouldn't be allowed to read SELinux status
dontaudit untrusted_app_all selinuxfs:file read;

# all other no-context attempt by apps (as spotted on iQIYI)
dontaudit untrusted_app_all sysfs_net:dir search;

# clear up tracing denials on user build
dontaudit {
  hal_atrace_default
  traced_probes
} debugfs_tracing_debug:file rw_file_perms;

# clear up many untrusted_app denials
dontaudit untrusted_app {
  app_data_file
  block_device
  cache_file
  proc
  proc_pid_max
  proc_tty_drivers
  proc_kmsg
  proc_net
  proc_net_tcp_udp
  proc_zoneinfo
  sysfs_net
  rootfs
}:dir rw_dir_perms;

dontaudit untrusted_app {
  app_data_file
  block_device
  cache_file
  proc
  proc_pid_max
  proc_tty_drivers
  proc_kmsg
  proc_net
  proc_net_tcp_udp
  proc_zoneinfo
  sysfs_net
  rootfs
}:{ lnk_file chr_file } rw_file_perms;

dontaudit untrusted_app {
  app_data_file
  block_device
  cache_file
  proc
  proc_pid_max
  proc_tty_drivers
  proc_kmsg
  proc_net
  proc_net_tcp_udp
  proc_zoneinfo
  sysfs_net
  rootfs
}:file rwx_file_perms;

dontaudit gmscore_app { bt_firmware_file firmware_file }:filesystem getattr;
